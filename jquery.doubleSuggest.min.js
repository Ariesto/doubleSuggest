(function(b){var h={init:function(d){return this.each(function(){function h(c){c&&clearTimeout(c);c=setTimeout(function(){u()},a.keyDelay)}function u(){var c=b.trim(e.val()).replace(/[\\]+|[\/]+/g,"").replace(/\s+/g," ");j=c;if(c.length>=a.minChars){a.beforeRetrieve&&(c=a.beforeRetrieve.call(this,c));e.addClass("loading");a.loadingText&&g.html('<li class="ds-message">'+a.loadingText+"</li>").show();f.show();if(a.remoteSource){n&&n.abort();var l={};l[a.queryParam]=c;n=b.getJSON(a.remoteSource,b.extend({},
l,a.extraParams),function(a){r(a,c,!1)})}a.localSource&&r(a.localSource,c,!0)}else f.hide()}function s(c){if(0<b("li.ds-result-item:visible",f).length){var l=b("li",f),d="down"===c?l.eq(0):l.filter(":last"),g=b("li.active:first",f);0<g.length&&(d="down"===c?g.next():g.prev());l.removeClass("active");d.addClass("active");0<d.length&&a.onResultFocus.call(e,d.data());c=0<d.length?d.data()[a.selectValue]:j;e.val(c)}}function r(c,d,h){var c=a.retrieveComplete.call(this,c,d,h),j=a.seekValue.split(","),
p=0,k=0,m=d.split(" ");if(h||!a.localSource)g.html(""),f.hide();for(var n in c)if(c.hasOwnProperty(n)){str="";for(var i=0;i<j.length;i++)str+=c[k][b.trim(j[i])];a.matchCase||(str=str.toLowerCase(),d=d.toLowerCase());i=!1;if(!0===h)for(var o in m)m.hasOwnProperty(o)&&-1!==str.search(m[o])&&(i=!0);if(!0===i||!1===h){c[k]._dataSource=h?"local":"remote";c[k]._number=p;var i=b('<li class="ds-result-item" id="ds-result-item-'+k+'"></li>').data(c[k]),q=b.extend({},c[k]);if(a.resultsHighlight)for(o in m)m.hasOwnProperty(o)&&
(q[a.selectValue]=q[a.selectValue].replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+m[o]+")(?![^<>]*>)(?![^&;]+;)",""+(!a.matchCase?"gi":"g")+""),"<em>$1</em>"));i=a.formatList?a.formatList.call(e,q,i):i.html(q[a.selectValue]);g.append(i);p++;if(a.queryLimit&&a.queryLimit===p)break}k++}e.removeClass("loading");0>=p&&a.emptyText&&g.html('<li class="ds-message">'+a.emptyText+"</li>");f.show();a.resultsComplete.call(this)}var a=b.extend({},b.fn.doubleSuggest.defaultOptions,d),e=b(this).addClass("ds-input"),
t=e.attr("id"),v=b('<div class="ds-container" id="ds-container-'+t+'"></div>');e.wrap(v);var f=b('<div class="ds-results" id="ds-results-'+t+'"></div>').hide();e.after(f);var g=b('<ul class="ds-list"></ul>').css("width",e.outerWidth()).appendTo(f),j="",n=null;e.on({"focus.doubleSuggest":function(){""!==b.trim(e.val())&&f.show()},"keydown.doubleSuggest":function(c){lastKey=c.keyCode;switch(lastKey){case 38:case 40:c.preventDefault();38===lastKey?s("up"):s("down");break;case 8:1===e.val().length&&f.hide();
h(lastKey,null);break;case 9:case 188:case 13:var d=b.trim(e.val()).replace(/(,)/g,"");if(""!==d&&d.length>=a.minChars&&(9===lastKey||13===lastKey)&&0<b("li.ds-result-item:visible",f).length&&0<b("li.active:first",g).length)b("li.active:first",g).trigger("select"),c.preventDefault();break;default:46==lastKey||9<lastKey&&32>lastKey?f.hide():h(null)}},"blur.doubleSuggest":function(){f.is(":hover")||(e.val(j),f.hide())},"updateOptions.doubleSuggest":function(c,e){a=b.extend(b.fn.doubleSuggest.defaultOptions,
d,e)},"destroy.doubleSuggest":function(){f.remove();e.val("").removeClass("ds-input").unbind(".doubleSuggest").unwrap()}});f.on({click:function(){b(this).trigger("select")},mouseover:function(){b("li",g).removeClass("active");b(this).addClass("active");a.onResultFocus.call(e,b(this).data())},select:function(){var c=b(this),d=c.data();j=d[a.selectValue];e.val(j);a.onSelect.call(e,d,c);g.html("");f.hide()}},".ds-result-item")})},update:function(d){return this.each(function(){b(this).trigger("updateOptions",
d)})},destroy:function(){return this.each(function(){b(this).trigger("destroy")})}};b.fn.doubleSuggest=function(d){if(h[d])return h[d].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof d||!d)return h.init.apply(this,arguments);b.error("Invalid arguments "+d+" on jQuery.doubleSuggest")};b.fn.doubleSuggest.defaultOptions={localSource:!1,remoteSource:!1,emptyText:!1,loadingText:"Loading...",newItem:!1,selectValue:"name",seekValue:"name",queryParam:"q",queryLimit:!1,extraParams:{},
matchCase:!1,minChars:1,keyDelay:500,resultsHighlight:!0,onSelect:function(){},onResultFocus:function(){},formatList:!1,beforeRetrieve:function(b){return b},retrieveComplete:function(b){return b},resultsComplete:function(){}}})(jQuery);