;(function(a){a.doubleSuggest={init:function(c){return this.each(function(){function h(a){a&&clearTimeout(a);a=setTimeout(function(){t()},b.keyDelay)}function t(){var d=a.trim(f.val()).replace(/[\\]+|[\/]+/g,"").replace(/\s+/g," ");i=d;if(d.length>=b.minChars){b.beforeRetrieve&&(d=b.beforeRetrieve.call(this,d));f.addClass("loading");b.loadingText&&g.html('<li class="ds-message">'+b.loadingText+"</li>").show();e.show();if(b.remoteSource){l&&l.abort();var k={};k[b.queryParam]=d;l=a.getJSON(b.remoteSource,
a.extend({},k,b.extraParams),function(a){n(a,d,!1)})}b.localSource&&n(b.localSource,d,!0)}else e.hide()}function q(d){if(0<a("li.ds-result-item:visible",e).length){var k=a("li.ds-result-item",e),c="down"===d?k.eq(0):k.eq(-1),g=a("li.active:first",e);0<g.length&&(c="down"===d?g.next("li.ds-result-item"):g.prev("li.ds-result-item"));k.removeClass("active");c.addClass("active");d=0<c.length?c.data()[b.selectValue]:i;f.val(d)}}function n(d,c,h){var d=b.retrieveComplete.call(this,d,c),i=b.seekValue.split(","),
o=0,j=0;h&&(g.html(""),e.hide());for(var l in d)if(d.hasOwnProperty(l)){str="";for(var m=0;m<i.length;m++)str+=d[j][a.trim(i[m])];b.matchCase||(str=str.toLowerCase(),c=c.toLowerCase());if(-1!==str.search(c)){d[j]._dataSource=h?"local":"remote";d[j]._position=o;var m=a('<li class="ds-result-item" id="ds-result-item-'+j+'"></li>').data(d[j]),p=a.extend({},d[j]),n=RegExp("(?![^&;]+;)(?!<[^<>]*)("+c+")(?![^<>]*>)(?![^&;]+;)",""+(!b.matchCase?"gi":"g")+"");b.resultsHighlight&&(p[b.selectValue]=p[b.selectValue].replace(n,
"<em>$1</em>"));g.append(b.formatList.call(this,p,m));o++;if(b.queryLimit&&b.queryLimit==o)break}j++}f.removeClass("loading");0>=o&&b.emptyText&&g.html('<li class="ds-message">'+b.emptyText+"</li>");e.show();b.resultsComplete.call(this)}var b=a.extend({},a.doubleSuggest.defaultOptions,c),f=a(this).addClass("ds-input"),r=f.attr("id"),s=a('<div class="ds-container" id="ds-container-'+r+'"></div>');f.wrap(s);var e=a('<div class="ds-results" id="ds-results-'+r+'"></div>').hide();f.after(e);var g=a('<ul class="ds-list"></ul>').css("width",
f.outerWidth()).appendTo(e),i="",l=null;f.on({"focus.doubleSuggest":function(){""!==a.trim(f.val())&&e.show()},"keydown.doubleSuggest":function(d){lastKey=d.keyCode;switch(lastKey){case 38:case 40:d.preventDefault();38===lastKey?q("up"):q("down");break;case 8:1===f.val().length&&e.hide();h(lastKey,null);break;case 9:case 188:case 13:var c=a.trim(f.val()).replace(/(,)/g,"");if(""!==c&&c.length>=b.minChars&&(9===lastKey||13===lastKey)&&0<a("li.ds-result-item:visible",e).length&&0<a("li.active:first",
g).length)a("li.active:first",g).trigger("select"),d.preventDefault();break;default:46==lastKey||9<lastKey&&32>lastKey?e.hide():h(null)}},"blur.doubleSuggest":function(){e.is(":hover")||(a("li.as-selection-item",s).addClass("blur").removeClass("selected"),e.hide())},"updateOptions.doubleSuggest":function(d,c){b=a.extend({},b,c)},"destroy.doubleSuggest":function(){e.remove();f.val("").removeClass("ds-input").unbind(".doubleSuggest").unwrap()}});e.on({click:function(){a(this).trigger("select")},mouseover:function(){a("li",
g).removeClass("active");a(this).addClass("active")},select:function(){var c=a(this).data();i=c[b.selectValue];f.val(i).focus();b.onSelect.call(this,c);e.hide()}},".ds-result-item")})},update:function(c){return this.each(function(){a(this).trigger("updateOptions",c)})},destroy:function(){return this.each(function(){a(this).trigger("destroy")})}};a.fn.doubleSuggest=function(c){if(a.doubleSuggest[c])return a.doubleSuggest[c].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof c||
!c)return a.doubleSuggest.init.apply(this,arguments);a.error("Invalid arguments "+c+" on jQuery.doubleSuggest")};a.doubleSuggest.defaultOptions={localSource:!1,remoteSource:!1,emptyText:!1,loadingText:"Loading...",newItem:!1,selectValue:"name",seekValue:"name",queryParam:"q",queryLimit:!1,extraParams:{},matchCase:!1,minChars:1,keyDelay:500,resultsHighlight:!0,onSelect:function(){},formatList:function(a,h){return h.html(a[opts.selectValue])},beforeRetrieve:function(a){return a},retrieveComplete:function(a){return a},
resultsComplete:function(){}}})(jQuery);