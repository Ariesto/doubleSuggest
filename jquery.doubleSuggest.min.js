(function(d){var k={init:function(a){return this.each(function(){function k(c){c&&clearTimeout(c);c=setTimeout(function(){t()},b.keyDelay)}function t(){var c=d.trim(e.val()).replace(/[\\]+|[\/]+/g,"").replace(/\s+/g," ");g=c;if(c.length>=b.minChars){b.beforeRetrieve&&(c=b.beforeRetrieve.call(this,c));e.addClass("loading");b.loadingText&&i.html('<li class="ds-message">'+b.loadingText+"</li>").show();f.show();if(b.remoteSource){p&&p.abort();var j={};j[b.queryParam]=c;p=d.getJSON(b.remoteSource,d.extend({}, j,b.extraParams),function(b){q(b,c,!1)})}b.localSource&&q(b.localSource,c,!0)}else f.hide()}function r(c){if(0<d("li.ds-result-item:visible",f).length){var j=d("li",f),a="down"===c?j.eq(0):j.filter(":last"),i=d("li.active:first",f);0<i.length&&(a="down"===c?i.next():i.prev());j.removeClass("active");a.addClass("active");0<a.length&&b.onResultFocus.call(e,a.data());c=0<a.length?a.data()[b.selectValue]:g;e.val(c)}}function q(c,j,a){var c=b.retrieveComplete.call(this,c,j,a),k=b.seekValue.split(","), g=0,l=0;if(a||!b.localSource)i.html(""),f.hide();for(var p in c)if(c.hasOwnProperty(p)){for(var m="",h=0;h<k.length;h++)m+=void 0!==c[l][d.trim(k[h])]?c[l][d.trim(k[h])]:"";b.matchCase||(m=m.toLowerCase(),j=j.toLowerCase());var h=j.split(" "),n=!1,o;for(o in h)h.hasOwnProperty(o)&&-1!==m.search(h[o])&&(n=!0);if(!0===n){c[l]._dataSource=a?"local":"remote";c[l]._number=g;m=d('<li class="ds-result-item" id="ds-result-item-'+l+'"></li>').data(c[l]);n=d.extend({},c[l]);if(b.resultsHighlight)for(o in h)h.hasOwnProperty(o)&& (n[b.selectValue]=n[b.selectValue].replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+h[o]+")(?![^<>]*>)(?![^&;]+;)",""+(!b.matchCase?"gi":"g")+""),"<em>$1</em>"));h=b.formatList?b.formatList.call(e,n,m):m.html(n[b.selectValue]);i.append(h);g++;if(b.queryLimit&&b.queryLimit===g)break}l++}e.removeClass("loading");0>=g&&b.emptyText&&i.html('<li class="ds-message">'+b.emptyText+"</li>");f.show();b.resultsComplete.call(this)}var b=d.extend({},d.fn.doubleSuggest.defaultOptions,a),e=d(this).addClass("ds-input"), s=e.attr("id"),u=d('<div class="ds-container" id="ds-container-'+s+'"></div>');e.wrap(u);var f=d('<div class="ds-results" id="ds-results-'+s+'"></div>').hide();e.after(f);var i=d('<ul class="ds-list"></ul>').css("width",e.outerWidth()).appendTo(f),g="",p=null;e.on({"focus.doubleSuggest":function(){""!==d.trim(e.val())&&f.show()},"keydown.doubleSuggest":function(c){var a=c.keyCode;switch(a){case 38:case 40:c.preventDefault();38===a?r("up"):r("down");break;case 8:1===e.val().length&&f.hide();k(a,null); break;case 9:case 188:case 13:var g=d.trim(e.val()).replace(/(,)/g,"");if(""!==g&&g.length>=b.minChars&&(9===a||13===a)&&0<d("li.ds-result-item:visible",f).length&&0<d("li.active:first",i).length)d("li.active:first",i).trigger("select"),c.preventDefault();break;default:46===a||9<a&&32>a?f.hide():k(null)}},"blur.doubleSuggest":function(){f.is(":hover")||(e.val(g),f.hide())},"updateOptions.doubleSuggest":function(c,e){b=d.extend(d.fn.doubleSuggest.defaultOptions,a,e)},"destroy.doubleSuggest":function(){f.remove(); e.val("").removeClass("ds-input").unbind(".doubleSuggest").unwrap()}});f.on({click:function(){d(this).trigger("select")},mouseover:function(){d("li",i).removeClass("active");d(this).addClass("active");b.onResultFocus.call(e,d(this).data())},select:function(){var c=d(this),a=c.data();g=a[b.selectValue];e.val(g);b.onSelect.call(e,a,c);i.html("");f.hide()}},".ds-result-item")})},update:function(a){return this.each(function(){d(this).trigger("updateOptions",a)})},destroy:function(){return this.each(function(){d(this).trigger("destroy")})}}; d.fn.doubleSuggest=function(a){if(k[a])return k[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return k.init.apply(this,arguments);d.error("Invalid arguments "+a+" on jQuery.doubleSuggest")};d.fn.doubleSuggest.defaultOptions={localSource:!1,remoteSource:!1,emptyText:!1,loadingText:"Loading...",newItem:!1,selectValue:"name",seekValue:"name",queryParam:"q",queryLimit:!1,extraParams:{},matchCase:!1,minChars:1,keyDelay:500,resultsHighlight:!0,onSelect:function(){},onResultFocus:function(){}, formatList:!1,beforeRetrieve:function(a){return a},retrieveComplete:function(a){return a},resultsComplete:function(){}}})(jQuery);